## 0. 푸시 서버 개선
- 테스트 코드 작성으로 빠른 검증 및 안정성 확보
- 리팩토링 (콜백 지옥의 비동기 코드들을 async/await로 비동기 처리하여 가독성, 유지보수성 향상) 
- Redis 캐싱 (반복적인 조회를 메모리에서 매우 빠르게 처리하여 성능 향상과 DB 부하 감소)

## 1. 프로젝트 개요
이 프로젝트는 서비스의 푸시 알림을 전문적으로 처리하기 위해 설계된 Node.js 기반의 마이크로서비스입니다. 
Firebase Admin SDK를 사용하여 FCM(Firebase Cloud Messaging)을 통해 사용자에게 효율적이고 안정적으로 푸시 메시지를 발송하는 역할을 담당합니다.

## 2. 주요 기능 및 특징
- 다양한 푸시 발송 방식 지원
  - 단일 사용자 발송: 특정 사용자 한 명에게 푸시를 보냅니다.
  - 다중 사용자 발송: 여러 명의 사용자에게 동시에 푸시를 보냅니다. (Multicast)
  - 토픽 기반 발송: 특정 주제(Topic)를 구독한 모든 사용자에게 푸시를 보냅니다.
  
- 계층형 아키텍처 (Layered Architecture)
  - Router → Service → DAO 구조를 채택하여 각 계층의 역할과 책임을 명확히 분리했습니다.
  - 이를 통해 코드의 응집도를 높이고 유지보수 및 테스트를 용이하게 만들었습니다.

- 데이터베이스 추상화
  - mybatis-mapper를 사용하여 SQL 쿼리를 애플리케이션 로직과 완전히 분리했습니다.
  - 복잡한 SQL 쿼리를 XML 파일에서 체계적으로 관리하여 가독성과 재사용성을 높였습니다.

- 고급 푸시 정책 관리
  - 발송 속도 제한 (Rate Limiting): 특정 종류의 푸시(프로필 방문, 친구 요청 등)에 대해 일일/시간당 발송 횟수를 제한하여 사용자 경험을 보호합니다.
  - 메시지 집계 (Message Aggregation): 단시간에 여러 개의 동일한 푸시가 발생할 경우, "A님 외 3명이 프로필을 방문했어요"와 같이 메시지를 지능적으로 통합하여 발송합니다.

- 안정적인 서버 운영
  - 중앙 집중식 에러 처리: Express 미들웨어를 활용하여 모든 에러를 한 곳에서 일관되게 처리하고 로깅합니다.
  - 정상 종료 (Graceful Shutdown): pm2 reload 또는 SIGINT, SIGTERM 신호 수신 시, 진행 중인 요청을 안전하게 처리하고 DB, Redis 등의 모든 연결을 순차적으로 종료하여 데이터 유실을 방지합니다.

- 신뢰성 높은 코드 품질
  - Jest와 Supertest를 사용한 단위 테스트 및 통합 테스트 코드가 작성되어 있어, 리팩토링이나 기능 추가 시 코드의 안정성을 보장합니다.

- 확장성을 고려한 설계
  - pm2의 클러스터 모드를 사용하여 멀티 코어 CPU를 최대한 활용하고, 무중단 서비스(Zero-downtime)를 지원하도록 설계되었습니다.
 
## 3. 프로젝트 구조

```
/
├── __tests__/          # Jest 테스트 파일 (단위 & 통합 테스트)
├── daos/               # 데이터베이스와 직접 통신하는 DAO(Data Access Object) 계층
├── mappers/            # mybatis-mapper를 위한 SQL 쿼리 XML 파일
├── routes/             # Express 라우터 정의 (API 엔드포인트)
├── services/           # 비즈니스 로직을 처리하는 서비스 계층
├── utils/              # DB, Redis, 비동기 핸들러 등 공통 유틸리티 모듈
├── .env                # 환경 변수 파일 (DB 접속 정보, 포트 등)
├── app.js              # 애플리케이션 메인 진입점
└── ecosystem.config.js # PM2 클러스터 모드 설정 파일
```

## 4. API 엔드포인트

| Method | Endpoind | 설명 | 요청 형식 |
|---|---|---|---|
| GET | /push/send | 단일 사용자에게 푸시를 발송합니다. | Query Parameter: params (URL 인코딩된 JSON 문자열) {"uuid":123, "title":"...", "message":"...", ...} |
| POST | /push/multisend | 여러 사용자에게 푸시를 발송합니다. | Body: {"uuid":[123, 456], "title":"...", "message":"...", ...} |
| POST | /push/topicsend | 특정 토픽을 구독한 사용자에게 푸시를 발송합니다. | Body: {"uuid":"topic_name", "title":"...", "message":"...", ...} |
